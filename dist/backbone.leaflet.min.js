/*! backbone.leaflet - v0.0.1-dev - 2/22/2013
* http://github.com/LuizArmesto/backbone.leaflet
* Copyright (c) 2013 Luiz Armesto; Licensed MIT */
(function(e,t,n){"use strict";var r=e.$,i={};i.VERSION="0.0.1-dev";var s=e.Leaflet;e.Leaflet=i,i.noConflict=function(){return e.Leaflet=s,this};var o=i.GeoModel=e.Model.extend({set:function(n,r,i){var s,o;return typeof n=="object"&&(s=n,i=r),s&&s.type&&s.type==="Feature"?(o=t.clone(s.properties),o.geometry=t.clone(s.geometry),e.Model.prototype.set.apply(this,[o,i])):e.Model.prototype.set.apply(this,arguments)},toJSON:function(e){var n,r,i;return n=t.clone(this.attributes),r=t.omit(n,"geometry"),i=n.geometry||null,{type:"Feature",properties:r,geometry:i}}}),u=function(e,t){var n;t===this.layer&&(n=this._getModelByFeature(e),this.modelFilter(n))},a=function(e){var t=this._getModelByFeature(e);this.modelStyle(t)},f=i.GeoCollection=function(n,r){n&&!t.isArray(n)&&n.features&&(n=n.features),e.Collection.apply(this,[n,r]),this.options=r||{},this._ensureLayer()};f.extend=e.Collection.extend,t.extend(f.prototype,e.Collection.prototype,{model:o,defaultLayerOptions:{filter:u,style:a},defaultStyle:{},toJSON:function(t){var n=e.Collection.prototype.toJSON.apply(this,arguments);return{type:"FeatureCollection",features:n}},modelFilter:function(e){return this.options.filter&&t.isFunction(this.options.filter)?this.options.filter.apply(this,arguments):!0},modelStyle:function(e){return this.options.style?t.isFunction(this.options.style)?this.options.style.apply(this,arguments):this.options.style:e.getStyle&&t.isFunction(e.getStyle)?e.getStyle():this.defaultStyle},_getModelByFeature:function(e){},_ensureLayer:function(){var e;this.layer||(this.layerOptions=t.defaults(this.options.layer||{},this.defaultLayerOptions),e=["filter","style"],t.each(e,function(e){this.layerOptions[e]=t.bind(this.layerOptions[e],this)},this),this.layer=new n.GeoJSON(null,this.layerOptions))}});var l=/^(\S+)\s*(.*)$/,c=i.MapView=function(t){e.View.apply(this,arguments)};c.extend=e.View.extend,t.extend(c.prototype,e.View.prototype,{defaultMapOptions:{center:[-23.5,-46.6167],zoom:14},delegateEvents:function(n){this._ensureMap();var r="delegateEvents"+this.cid;e.View.prototype.delegateEvents.apply(this,arguments);if(!n&&!(n=t.result(this,"events")))return this;this._leaflet_events={};for(var i in n){var s=n[i];t.isFunction(s)||(s=this[n[i]]);if(!s)throw new Error('Method "'+n[i]+'" does not exist');var o=i.match(l),u=o[1],a=o[2];s=t.bind(s,this),a==="map"&&(this.map.on(u,s,r),this._leaflet_events[u]=s)}return this},undelegateEvents:function(){var t="delegateEvents"+this.cid;return this.map.off(this._leaflet_events||{},t),this._leaflet_events=null,e.View.prototype.undelegateEvents.apply(this,arguments)},getTileLayer:function(){return new n.TileLayer("http:///{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{attribution:'Data, imagery and map information provided by <a href="http://www.mapquest.com/">MapQuest</a>, <a href="http://www.openstreetmap.org/">Open Street Map</a> and contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.',subdomains:["otile1","otile2","otile3","otile4"]})},_ensureMap:function(){this.map||(this.mapOptions=t.defaults(this.options.map||{},this.defaultMapOptions),this.map=new n.Map(this.el,this.mapOptions),this.tileLayer=this.getTileLayer(),this.tileLayer.addTo(this.map))}});var h=i.SatelliteView=c.extend({defaultMapOptions:{center:[-23.5,-46.6167],zoom:11},getTileLayer:function(){return new n.TileLayer("http:///{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{attribution:'Data and imagery provided by <a href="http://www.mapquest.com/">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency.',subdomains:["otile1","otile2","otile3","otile4"]})}})})(Backbone,_,L);